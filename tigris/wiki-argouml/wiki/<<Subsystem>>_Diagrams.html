---
layout: oldtigrissite
---
<h1><small>From the ArgoUML wiki at argouml.tigris.org.</small><br />         Wiki: &lt;&lt;Subsystem&gt;&gt; Diagrams
    </h1>
</div>
 
 
 
        
                 
                 
           
    
  

 
 





<div class="wiki">




<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><dl><dt>Purpose</dt><dd>To present the diagrams to the user and allow the user to manipulate the diagrams through the view. <span class="anchor" id="line-2"></span></dd><dt>Located</dt><dd><p class="line891"><strong>org.argouml.uml.diagram</strong> <span class="anchor" id="line-3"></span></dd><dt>Layer</dt><dd><p class="line891"><a href="&lt;&lt;Layer&gt;&gt;_View_and_Control_subsystems.html">&lt;&lt;Layer&gt;&gt; View and Control subsystems</a> <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span></dd></dl><p class="line867">
<h4 id="head-1d79856bb9aacfe8e57f0c718029474a0c400324">Used sybsystems</h4>
<span class="anchor" id="line-6"></span><p class="line874">This subsystem uses the following other subsystems: <span class="anchor" id="line-7"></span><ul><li><p class="line891"><a href="&lt;&lt;Subsystem&gt;&gt;_Model.html">&lt;&lt;Subsystem&gt;&gt; Model</a> <span class="anchor" id="line-8"></span></li><li><p class="line891"><a href="&lt;&lt;Subsystem&gt;&gt;_The_GUI.html">&lt;&lt;Subsystem&gt;&gt; The GUI</a> <span class="anchor" id="line-9"></span></li><li><p class="line891"><a href="&lt;&lt;Subsystem&gt;&gt;_Notation.html">&lt;&lt;Subsystem&gt;&gt; Notation</a> <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span></li></ul><p class="line867">
<h3 id="head-516952824dc163a28860f879d5fc41a494f9b8e3">Design of the subsystem</h3>
<span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line862">The classes in this subsystem are extensions of the GEF base classes (<tt>GraphModel</tt>s, <tt>Fig</tt>s, <tt>Selection</tt>s etc) together with some supporting classes. <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line874">This subsystem has no direct access to a specific implementation of the OMG model repository. However it does update such a repository via the interface of the Model Subsystem. <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line862">There is an intention (Bob Tarling) to split this subsystem into several smaller subsystems, one for each diagram type. This is to allow for indiviual diagram reuse by other applications and to allow us to fast track developers onto a specific subproject containing that subsystem (Michael MacDonald and sequence diagrams in mind). <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line867"><a class="attachment" href="classdiagramfigs.gif" >Class diagram of the class/package diagram figures</a> (<a class="attachment" href="ArgoDiagram.zargo" >project</a> file) <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><p class="line867">
<h3 id="head-57f23039e71b88eff0e65a994f70377064ffa88b">Design of the Figs</h3>
<span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><p class="line867">
<h4 id="head-22b07738d600ce0bee57595b6fd667af28ea5d5c">The Coordinate system</h4>
<span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><p class="line874">All coordinates used by the Figs from GEF are specified  <span class="anchor" id="line-27"></span>in a device-independent coordinate system called User Space.   <span class="anchor" id="line-28"></span>The low level drawing code converts these coordinates from user space to <span class="anchor" id="line-29"></span>device-dependent coordinates in Device Space. <span class="anchor" id="line-30"></span>Coordinates in device space usually refer to individual device pixels <span class="anchor" id="line-31"></span>and are aligned on the infinitely thin gaps between these pixels. <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><p class="line862">See the JavaDoc of the <a class="http" href="http://java.sun.com/j2se/1.5.0/docs/api/java/awt/Graphics2D.html">Graphics2D</a> class for more information. <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line874">The origin of the User Space coordinate system  <span class="anchor" id="line-36"></span>maps to the upper left hand corner of the <span class="anchor" id="line-37"></span>target region of the device with increasing X coordinates extending <span class="anchor" id="line-38"></span>to the right and increasing Y coordinates extending downward. <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line867">
<h4 id="head-4c3a4ef16bff1e4ac24a0909fc06155c781e4b36">Line widths</h4>
<span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><p class="line874">Line widths are included in the size of the Fig. <span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><p class="line874">In the following, we use: <span class="anchor" id="line-45"></span><div><table><tbody><tr>  <td><p class="line862"> (x, y) </td>
  <td><p class="line862"> the top left coordinate </td>
</tr>
<tr>  <td><span class="anchor" id="line-46"></span><p class="line862"> w </td>
  <td><p class="line862"> the width of the box </td>
</tr>
<tr>  <td><span class="anchor" id="line-47"></span><p class="line862"> h </td>
  <td><p class="line862"> the height of the box </td>
</tr>
</tbody></table></div><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><p class="line874">This means that e.g. the dimensions of a box are its outside dimensions, and <span class="anchor" id="line-50"></span>inside it, there is an area filled with the fill color that has the following dimension: <span class="anchor" id="line-51"></span><ul><li style="list-style-type:none">width : w - 2 * lineWidth  <span class="anchor" id="line-52"></span>height : h - 2 * lineWidth  <span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span></li></ul><p class="line874">The line color is used to draw the border around the before mentioned box. There are 4 line segments drawn, of which the top horizontal one goes from: <span class="anchor" id="line-55"></span><ul><li style="list-style-type:none">(x + linewidth / 2, y + linewidth / 2)  <span class="anchor" id="line-56"></span></li></ul><p class="line874">to: <span class="anchor" id="line-57"></span><ul><li style="list-style-type:none">(x + w - linewidth, y + linewidth / 2)  <span class="anchor" id="line-58"></span></li></ul><p class="line874">This because the width of the line extends on both sides of the infinitesimal narrow line between the same end points. <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><p class="line867">
<h3 id="head-f62ffca23e3fe8c22e609a93b32cef14bf950aae">Multi editor pane</h3>
<span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><p class="line874">The multi editor pane is the pane with the diagram editor in it. Normally it is placed in the upper right corner of the application. One of the feature requests is to make the pane dockable so maybe it won't be there in the future. <span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><p class="line874">The multi editor pane consists of tabs that hold editors as you can see in the class diagram.  <span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><p class="line867"><img src="multieditorpane.gif" /> <span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><p class="line862">At the moment there is only one editor tab in place. This is the <tt>TabDiagram</tt> that shows an <tt>UMLDiagram</tt>, the target. <span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><p class="line862">The target of the <tt>MultiEditorPane</tt> is set via the <tt>setTarget</tt> method of the pane. This method is called by the <tt>setTarget</tt> method of the <tt>ProjectBrowser</tt>. The pane's <tt>setTarget</tt> method will call each <tt>setTarget</tt> method of each tab that is an instance of <tt>TabModelTarget</tt>. Besides setting the target of the tabs, the <tt>setTarget</tt> method also calls <tt>MultiEditorPane.select(Object&nbsp;o)</tt>. This selects the new target on a tab. This probably belongs in the <tt>setTarget</tt> method of the individual tabs and diagrams but that's how it's implemented at the moment. <span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><p class="line867">
<h4 id="head-50bbdf920efef6fd666630a834bb86c96cdb9d63">How do I ...?</h4>
<span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><ul><li><p class="line862">...add a new tab to the <tt>MultiEditorPane</tt>? <span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span></li><li class="gap" style="list-style-type:none"><p class="line862">Create a new class that's a child of <tt>JPanel</tt> and put the following line in argo.ini: <span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span></li><li class="gap" style="list-style-type:none">multi:  fully classified name of new tab class <span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span></li></ul><p class="line867">
<h3 id="head-36360916ba8503136f5e6104d9c26113e88c2b71">How do I add a new element to a diagram?</h3>
<span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><p class="line874">To add a new element to a diagram, two main things have to be done. <span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><ol type="1"><li><p class="line862">Create new Fig classes to represent the element on the diagram and add them to the graph model (<strong>org.argouml.uml.diagram.<em>xxxx</em>.<em>Xxxx</em>DiagramGraphModel.java</strong>) and renderer (<strong>org.argouml.uml.diagram.<em>xxxx</em>.ui.<em>Xxxx</em>DiagramRenderer.java</strong>). <span class="anchor" id="line-86"></span></li><li><p class="line862">Create a new property panel class that will be displayed in the property tab window on the details pane. This is described in <a href="&lt;&lt;Subsystem&gt;&gt;_Property_panels.html">&lt;&lt;Subsystem&gt;&gt; Property panels</a>. <span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span></li></ol><p class="line874">Throughout we shall use the example of adding the UML Extend relationship to a use case diagram. This allows two Use Cases to be joined by a dotted arrow labeled «extend» to show that one extends the behavior of the other. <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><p class="line874">The classes involved in this particular example have all been well commented and have full Javadoc descriptions, to help when examining the code. You will need to read the description here in conjunction with looking at the code. <span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><p class="line867">
<h3 id="head-df817c6705b758b64702138416606531186b1446">How to add a new Fig</h3>
<span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><p class="line874">The new item must be added to the tool-bar. Both the graph model and diagram renderer for the diagram will need modifying for any new fig object. <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><p class="line867">
<h4 id="head-013407bb75248f3b0c2fdb62d4915300f2f3aee0">Adding to the tool-bar of the diagram</h4>
<span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><p class="line862">Find the diagram object in <strong>uml/diagram/<em>XXXX</em>/ui/UML<em>YYYY</em>Diagram.java</strong>, where <em><strong>XXXX</em></strong> is the diagram type (lower case) and <em><strong>YYYY</em></strong> the diagram type (bumpy caps). For example <strong>uml/diagram/use_case/ui/UMLUseCaseDiagram.java</strong>. This will be a subclass of <tt>UMLDiagram</tt> (in <strong>uml/diagram/ui/UMLDiagram.java</strong>). <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><p class="line862">Each tool-bar action is declared as a private static field of class Action, initiated as a new <tt>CmdCreateNode</tt> (for nodal UML elements) or a new <tt>CmdSetMode</tt> (for behavior, or creation of line UML elements). These classes are part of the GEF library. <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><p class="line862">The common ones (select, broom, graphic annotations) are inherited from <tt>UMLDiagram</tt>, the diagram specific ones in the class itself. For example in <strong>UMLUseCaseDiagram.java</strong> we have the following for creating Use Case nodes. <span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><p class="line867"><span class="anchor" id="line-105"></span><pre>private static Action actionUseCase;
<span class="anchor" id="line-106"></span></pre><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><p class="line874">which is then created as follows: <span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><p class="line867"><span class="anchor" id="line-111"></span><pre>    protected Action getActionUseCase() {
<span class="anchor" id="line-112"></span>        if (actionUseCase == null) {
<span class="anchor" id="line-113"></span>            actionUseCase = new RadioAction(new CmdCreateNode(
<span class="anchor" id="line-114"></span>                    Model.getMetaTypes().getUseCase(), "button.new-usecase"));
<span class="anchor" id="line-115"></span>        }
<span class="anchor" id="line-116"></span>        return actionUseCase;
<span class="anchor" id="line-117"></span>    }
<span class="anchor" id="line-118"></span></pre><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><p class="line862">The first argument of the <tt>CmdCreateNode()</tt> function is the class of the node to create from the <a href="&lt;&lt;Subsystem&gt;&gt;_Model.html">&lt;&lt;Subsystem&gt;&gt; Model</a> Metatypes interface, the second a textual tool tip. <span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><p class="line862">The tool-bar is actually created by defining a method, <tt>UMLDiagram.initToolBar()</tt> which adds the tools in turn to the tool-bar (a private member named <tt>toolBar</tt>). <span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><p class="line862">The default constructor for the diagram is declared public, despite that it must not be called directly - it is needed for loading projects from files. The desired constructor takes a name-space as an argument, and sets up a graph model (<tt>UseCaseDiagramGraphModel</tt>), layer perspective and renderer (<tt>UseCaseDigramRenderer</tt>) for nodes and edges. <span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><p class="line867">
<h4 id="head-c5ee0bdd12dbf102a9fc8f2cdc56f965d6410c67">Changing the graph model</h4>
<span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><p class="line862">The graph model is the bridge between the UML meta-model representation of the design and the graph model of GEF. They are found in the parent directory of the corresponding diagram class, and have the general name <strong><em>YYYY</em>DiagramGraphModel.java</strong>, where <em><strong>YYYY</em></strong> is the diagram name in bumpy caps. For example the use case diagram graph model is in <strong>uml/diagram/use_case/UseCaseDiagramGraphModel.java</strong> <span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><p class="line862">The graph model is defined as <tt>UMLMutableGraphSupport</tt>, a child of the GEF class <tt>MutableGraphSupport</tt>, and should implement <tt>MutableGraphModel</tt> (GEF). <span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><p class="line867">
<h4 id="head-5bd73d5714d70cd14dee90f79e80880905c74756">Changing the renderer</h4>
<span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><p class="line862">The renderer is responsible for creating graphic figs as required on the diagram. It is found in the same directory of the corresponding diagram class, and has the general name <strong><em>YYYY</em>DiagramRenderer.java</strong>, where <em><strong>YYYY</em></strong> is the diagram name in bumpy caps. For example the use case diagram graph model is in <strong>uml/diagram/use_case/ui/UseCaseDiagramRenderer.java</strong> <span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><p class="line862">This provides two routines, <tt>getFigNodeFor()</tt>, which provides a fig object to represent a given UML node object and <tt>getFigEdgeFor()</tt>, which provides a fig object to represent a given UML edge object. <span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><p class="line862">In our example, we must extend <tt>getFigEdgeFor()</tt> so it can handle UML Extend objects (producing a <tt>FigExtend</tt>). <span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><p class="line867">
<h4 id="head-07fa838fe16c74bde0126ca26ab990c6f0a326ad">Creating a new Fig</h4>
<span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><p class="line862">Assuming you have your model element already defined in the UML model and your <tt>PropPanel</tt> for that model element, you should make the <tt>Fig</tt> class. <span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><p class="line862">New objects that are to appear on a diagram will require new <tt>Fig</tt> classes to represent them. They are placed in the same directory as the diagram that uses them. <span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><ol type="1"><li><p class="line862">Nodes that are Figs that are closed figures like <tt>FigClass</tt>, extend from <tt>FigNodeModelElement</tt>. Edges that are lines like <tt>FigAssociation</tt>, extend from <tt>FigEdgeModelElement</tt>. The name of the <tt>Fig</tt> has to start with (yes indeed) <tt>Fig</tt>. The rest of the name should be equal to the model element name. <span class="anchor" id="line-148"></span></li><li><p class="line862">The implementation of a Fig must provide one constructor with as parameter the owner, the bounds (only if the fig has dimensions, i.e. if it is a node), and <tt>DiagramSettings</tt> for its rendering. In the constructor, you draw the lines and text fields, and add them by calling <tt>addFig(Fig)</tt> in the sequence of layering: the one on the top should be added last. See <tt>FigActionState</tt> and <tt>FigAssociation</tt> for an example of this. <span class="anchor" id="line-149"></span></li><li><p class="line862">Create a <tt>NotationProvider</tt> for the UML language, and overrule the method <tt>getNotationProviderType</tt> in the new <tt>Fig</tt> to define its usage. This allows the "name" to be rendered and edited. BTW: There is no reason why this should be limited to a name - e.g. <tt>FigTransition</tt> uses this for something else. <span class="anchor" id="line-150"></span></li><li><p class="line862">If you have more than one text field that can be edited, override the method <tt>textEditStarted(FigText&nbsp;text)</tt> and <tt>textEdited(FigText&nbsp;text)</tt>. This latter method is called AFTER the user edited the text. In this method the edited text is parsed. If the parsing is simple and not Notation specific, just do it in <tt>textEdited</tt>. But for most cases: use the <a href="&lt;&lt;Subsystem&gt;&gt;_Notation.html">&lt;&lt;Subsystem&gt;&gt; Notation</a>, see e.g. <tt>FigState</tt>. <span class="anchor" id="line-151"></span></li><li><p class="line862">Make an <tt>Action</tt> that can be called from the GUI. If you are lucky, you just can use <tt>CmdCreateNode</tt>. See for examples <tt>UMLClassDiagram</tt> of using <tt>CmdCreateNode</tt>. <span class="anchor" id="line-152"></span></li><li><p class="line862">Adapt the method <tt>canAddEdge(Object&nbsp;o)</tt> on subclasses of <tt>GraphModel</tt> if you are building an edge so it will return true if the edge may be added to the subclass. Subclasses are for example <tt>ClassDiagramGraphModel</tt> and <tt>UseCaseDiagramGraphModel</tt>. If you are building a node, adapt <tt>canAddNode(Object&nbsp;o)</tt>. <span class="anchor" id="line-153"></span></li><li><p class="line862">Adapt the method <tt>getFigEdgeFor</tt> on implementors of <tt>GraphEdgeRenderer</tt> if you are implementing an edge so it will return the correct <tt>FigEdge</tt> for your object. If you are implementing a node, adapt the method <tt>getFigNodeFor</tt> on implementors of <tt>GraphNodeRenderer</tt>. In ArgoUML classes like <tt>ClassDiagramRenderer</tt> implement these interfaces. <span class="anchor" id="line-154"></span></li><li><p class="line862">Add an image file for the buttons to the resource directory <strong>org/argouml/Images</strong>. This image file must be of GIF format and have a drawing of the button image to be used in itself. Its dimensions shall be 16x16. This image is also used on the <tt>PropPanel</tt>. The name of the Image file should be <strong><em>model element</em>.gif</strong>. <span class="anchor" id="line-155"></span></li><li><p class="line862">Add buttons to the action you created on those places in the GUI that have a need for it. This should be at least the button bar in each diagram where you can draw your model element. Probably the parent of your model element (e.g. class in case of operation) will want a button too, so add it to the <tt>PropPanel</tt> of the parent. In case of the diagrams, add it in <strong>UMLdiagram.java</strong>, so in <tt>UMLClassDiagram</tt> if it belongs there. In case of the <tt>PropPanel</tt>s, use <tt>UndoableAction</tt>. Also, the right-click pop-up menu of the parent Fig on the diagram is a good location to add the Action. <span class="anchor" id="line-156"></span></li></ol><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-157"></span><a href="http://argouml.tigris.org/wiki/CategoryTemplate">CategoryTemplate</a> <span class="anchor" id="line-158"></span><span class="anchor" id="bottom"></span></div><p id="pageinfo" class="info" lang="en" dir="ltr">&lt;&lt;Subsystem&gt;&gt; Diagrams  (last edited 2009-09-30 18:04:28 -0700 by <span title="Michiel van der Wulp @ localhost[127.0.0.1]"><a href="mvw.html" title="Michiel van der Wulp @ localhost[127.0.0.1]">mvw</a></span>)</p>

